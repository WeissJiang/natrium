plugins {
    id 'com.github.node-gradle.node' version '3.0.0-rc2'
}

/**
 * @see package.json
 */
task installNodeModules(type: YarnTask) {
    args = ['i']
}

task stage {
    dependsOn subprojects.collect { ":${it.name}:build" }
}

// stage skip tests
gradle.taskGraph.whenReady { graph ->
    if (graph.hasTask(stage)) {
        graph.allTasks.findAll { it instanceof Test }
                .each { it.enabled = false }
    }
}

node {
    version = '14.9.0'
    yarnVersion = '1.22.5'
    download = true
}
