task stage {
    dependsOn(subprojects.collect { ":${it.name}:build" })
}

// stage skip tests
gradle.taskGraph.whenReady({ graph ->
    if (graph.hasTask(stage)) {
        graph.allTasks.findAll { it instanceof Test }
                .each { it.enabled = false }
    }

} as Action<TaskExecutionGraph>)
